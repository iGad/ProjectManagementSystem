<div style="margin-top:51px" ng-cloak class="md-inline-form" ng-controller="WorkItemController">
    <md-content class="md-padding without-errors" style="width: 100%; height: 100%">
        <ng-form name="addUpdateWorkItemForm" flex>
            <div layout="row" layout-align="space-between">
                <div layout="row" flex>
                    <md-button class="md-icon-button" aria-label="back" ng-click="cancel()">
                        <md-tooltip md-direction="bottom">Назад</md-tooltip>
                        <md-icon md-svg-icon="navigation:arrow_back">
                        </md-icon>
                    </md-button>
                    <md-input-container class="md-block " ng-if="workItem.Id" style="width: 120px">
                        <label>Идентификатор</label>
                        <input ng-model="workItem.Id" disabled></input>
                    </md-input-container>
                    <md-input-container class="md-block" flex>
                        <label>{{workItemName}}</label>
                        <input ng-model="workItem.Name" md-select-on-focus required ng-change="formChanged()" ng-disabled="!canEdit"></input>
                    </md-input-container>
                </div>
                <div layout="row" flex layout-align="end start">
                    <md-button ng-click="save()" ng-disabled="addUpdateWorkItemForm.$invalid || !canEdit || !isFormChanged">
                        <md-icon md-svg-icon="content:save"></md-icon>
                        Сохранить
                    </md-button>
                    <md-button ng-click="delete()" ng-if="!isNew" ng-disabled="canEdit && canDelete">
                        <md-icon md-svg-icon="action:delete" md-menu-align-target></md-icon>
                        Удалить
                    </md-button>
                </div>
            </div>

            <div layout="row">
                <div layout="column" style="width: 100%; height: 100%">

                    <md-content class="md-padding content-back">
                        <div layout-gt-sm="row">
                            <md-input-container class="md-block">
                                <label>Тип</label>
                                <md-select ng-model="workItem.Type" required ng-change="typeChanged(workItem.Type);formChanged()" ng-disabled="!isNew">
                                    <md-option ng-repeat="type in types" ng-value="type.Id">
                                        {{type.Name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                            <md-input-container class="md-block" flex ng-if="!isNew">
                                <label>Состояние</label>
                                <md-select ng-model="workItem.State" ng-change="formChanged()" ng-disabled="!canEdit">
                                    <md-option ng-repeat="state in states" value="{{state.Value}}" >
                                        {{state.Description}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>

                        <div layout-gt-sm="row" ng-if="workItem.Type && !isProject">
                            <md-input-container class="md-block" flex-gt-sm>
                                <label>Проект</label>
                                <md-select ng-model="parentProjectId" required ng-change="projectChanged(parentProjectId);formChanged()" ng-disabled="!isStage && !isNew">
                                    <md-option ng-repeat="project in projects" ng-value="project.Id">
                                        {{project.Name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>

                            <md-input-container class="md-block" flex-gt-sm ng-if="!isStage" >
                                <label>Стадия</label>
                                <md-select ng-model="parentStageId" required ng-change="stageChanged(parentStageId); formChanged()" ng-disabled="!isPartition && !isNew">
                                    <md-option ng-repeat="stage in stages" ng-value="stage.Id">
                                        {{stage.Name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>

                            <md-input-container class="md-block" flex-gt-sm ng-if="!isPartition && !isStage">
                                <label>Раздел</label>
                                <md-select ng-model="parentPartitionId" required ng-change="formChanged()"  ng-disabled="(!isTask && !isNew) || !canEdit">
                                    <md-option ng-repeat="partition in partitions" ng-value="partition.Id">
                                        {{partition.Name}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div layout-gt-xs="row">
                            <md-input-container class="md-block" flex="50">
                                <label>Исполнитель</label>
                                <md-select ng-model="workItem.ExecutorId"  ng-change="formChanged()" ng-disabled="!canEdit">
                                    <md-option>Отсутствует</md-option>
                                    <md-option ng-repeat="user in users" value="{{user.Id}}">
                                        {{getUserDisplayText(user)}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                            <md-input-container>
                                <label>Дедлайн</label>
                                <md-datepicker ng-model="workItem.DeadLine" required ng-change="formChanged()" ng-disabled="!canEdit"></md-datepicker>
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>Часы</label>
                                <input type="number" md-min="0" md-max="23" ng-model="workItem.DeadLineHours" required ng-change="formChanged()" ng-disabled="!canEdit">
                            </md-input-container>
                            <md-input-container class="md-block" flex-gt-xs>
                                <label>Минуты</label>
                                <input type="number" md-min="0" md-max="59" ng-model="workItem.DeadLineMinutes" required ng-change="formChanged()" ng-disabled="!canEdit">
                            </md-input-container>
                        </div>

                        <md-input-container class="md-block without-errors">
                            <label>Описание</label>
                            <textarea ng-model="worItem.Description" rows="3" md-select-on-focus ng-change="formChanged()" ng-disabled="!canEdit"></textarea>
                        </md-input-container>
                    </md-content>

                </div>
                <div layout="column" style="width: 100%;">
                    <md-content class="content-back">
                        <md-tabs>
                            <md-tab label="Связи">
                                <div ng-controller="LinkedWorkItemsController">
                                    <div layout="row">
                                        <md-menu>
                                            <md-button class="md-icon-button" aria-label="add" ng-click="$mdOpenMenu()">
                                                <md-icon md-svg-icon="content:add"></md-icon>
                                            </md-button>
                                            <md-menu-content width="4">
                                                <md-menu-item>
                                                    <md-button ng-click="addChildren()" ng-disabled="!canAdd">
                                                        <md-icon md-svg-icon="av:playlist_add" md-menu-align-target></md-icon>
                                                        Дочерний элемент
                                                    </md-button>
                                                </md-menu-item>
                                                <md-menu-divider></md-menu-divider>
                                                <md-menu-item>
                                                    <md-button  ng-click="addInnerDependency()" ng-disabled="!canEdit">
                                                        <md-icon md-svg-icon="communication:call_received"></md-icon>
                                                        Зависимость от
                                                    </md-button>
                                                </md-menu-item>
                                                <md-menu-divider></md-menu-divider>
                                                <md-menu-item>
                                                    <md-button ng-click="addOutterDependency()" ng-disabled="!canEdit">
                                                        <md-icon md-svg-icon="communication:call_made"></md-icon>
                                                        Зависимость к
                                                    </md-button>
                                                </md-menu-item>
                                            </md-menu-content>
                                        </md-menu>
                                    </div>
                                    <div layout="column" ng-repeat="itemsLink in linkedItemsCollection" ng-if="linkedItemsCollection && itemsLink.WorkItems.length !== 0">
                                        <div layout="column">
                                            <label>{{itemsLink.LinkName}}</label>
                                            <div class="linked-item-row" layout="row" ng-repeat="workItem in itemsLink.WorkItems" ng-click="edit(workItem.Id)">
                                                <div class="tile-type" ng-class="getWorkItemClass(workItem)"></div>
                                                <div class="id">
                                                    {{workItem.Id}}
                                                </div>
                                                <div class="title">{{workItem.Name}}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </md-tab>
                            <md-tab label="Файлы">
                                <md-content class="md-padding">
                                    <h1 class="md-display-2">Tab Two</h1>
                                    <p>Lorem ipsum dolor sit amet,.</p>
                                    <p>Morbi viverra, ante vel aliquet tincidunt,.</p>
                                    <p>Integer turpis erat, porttitor vitae mi faucibus, laoreet i</p>
                                </md-content>
                            </md-tab>
                            <md-tab label="Дополнительно">
                                <md-content class="md-padding">
                                    <h1 class="md-display-2">Tab Three</h1>
                                    <p>Integer turpis erat, porttitor vitae mi faucibus, .</p>
                                </md-content>
                            </md-tab>
                        </md-tabs>
                    </md-content>

                </div>
            </div>
            <div layout="row">
                <md-content class="md-padding content-back" style="width: 100%; heigth: 100%">
                    <md-tabs>
                        <md-tab label="Обсуждение">
                            <md-content class="md-padding">
                                <h1 class="md-display-2">Связи</h1>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit..</p>
                            </md-content>
                        </md-tab>
                    </md-tabs>
                </md-content>

            </div>
        </ng-form>
    </md-content>
</div>
